<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta property="og:title" content='isValidEmail("wtf")'>
  <meta property="og:description" content="How well do you know email validation?">
  <meta property="og:url" content="https://e-mail.wtf">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://e-mail.wtf/og.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:site_name" content="e-mail.wtf">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content='isValidEmail("wtf")'>
  <meta name="twitter:description" content="How well do you know email validation?">
  <meta name="twitter:image" content="https://e-mail.wtf/og.png">

  <title>The Email Validation Quiz</title>
  <style>
    :root {
      --wong-orange: #E69F00;
      --wong-orange-dark: #CC8800;
      --wong-sky-blue: #56B4E9;
      --wong-bluish-green: #009E73;
      --wong-yellow: #F0E442;
      --wong-blue: #0072B2;
      --wong-blue-dark: #005A8F;
      --wong-vermillion: #D55E00;
      --wong-red-purple: #CC79A7;
      --wong-black: #000000;
      --wong-grey: #999999;

      --gray-50: #F5F5F5;
      --gray-100: #E5E5E5;
      --gray-200: #D4D4D4;
      --gray-300: #B0B0B0;
      --gray-400: #737373;
      --gray-500: #525252;
      --gray-600: #404040;
      --gray-700: #2A2A2A;
      --gray-800: #1A1A1A;
      --gray-900: #0F0F0F;

      --white: #FFFFFF;
      --black: #000000;
    }

    :root {
      --color-primary: var(--wong-orange);
      --color-primary-hover: var(--wong-orange-dark);
      --color-secondary: var(--wong-blue);
      --color-secondary-hover: var(--wong-blue-dark);

      --color-bg-dark: var(--gray-900);
      --color-bg-medium: var(--gray-800);
      --color-bg-light: var(--gray-700);
      --color-bg-lighter: var(--gray-600);

      --color-text-primary: var(--gray-50);
      --color-text-secondary: var(--gray-300);

      --color-border: var(--gray-600);
      --color-border-hover: var(--gray-500);
      --color-border-light: var(--gray-500);

      --color-error: var(--wong-vermillion);
      --color-correct-bg: rgba(0, 158, 115, 0.15);
      --color-incorrect-bg: rgba(213, 94, 0, 0.15);
      --color-accent-green: var(--wong-bluish-green);
      --color-code-bg: var(--gray-900);

      --shadow-strength: 0.5;

      --spacing-xs: 4px;
      --spacing-sm: 8px;
      --spacing-md: 12px;
      --spacing-lg: 15px;
      --spacing-xl: 20px;
      --spacing-2xl: 25px;
      --spacing-3xl: 30px;
      --spacing-4xl: 40px;

      --font-system: Avenir, Montserrat, Corbel, 'URW Gothic', source-sans-pro, sans-serif;
      --font-mono: ui-monospace, 'Cascadia Mono', 'Source Code Pro', Menlo, Consolas, 'DejaVu Sans Mono', monospace;
      --font-size-sm: 0.9em;
      --font-size-base: 1em;
      --font-size-lg: 1.1em;
      --font-size-xl: 2em;
      --font-size-2xl: 2.5em;
      --font-size-3xl: 3em;
      --line-height: 1.6;

      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;

      --shadow-default: 0 4px 20px rgba(0, 0, 0, var(--shadow-strength));
      --shadow-subtle: 0 2px 8px rgba(0, 0, 0, calc(var(--shadow-strength) * 0.6));

      --container-max-width: 600px;

      --border-thin: 1px;
      --border-medium: 2px;
      --border-thick: 4px;

      --option-key-size: 30px;
    }

    [data-theme="light"] {
      --color-primary: var(--wong-orange-dark);
      --color-primary-hover: #B36A00;
      --color-secondary: var(--wong-blue-dark);
      --color-secondary-hover: #004A7A;

      --color-bg-dark: var(--white);
      --color-bg-medium: #F7F7F7;
      --color-bg-light: var(--gray-100);
      --color-bg-lighter: var(--gray-200);

      --color-text-primary: var(--gray-800);
      --color-text-secondary: var(--gray-400);

      --color-border: var(--gray-200);
      --color-border-hover: var(--gray-300);
      --color-border-light: var(--gray-200);

      --color-error: var(--wong-vermillion);
      --color-correct-bg: rgba(0, 158, 115, 0.1);
      --color-incorrect-bg: rgba(213, 94, 0, 0.1);
      --color-accent-green: var(--wong-bluish-green);
      --color-code-bg: var(--gray-50);

      --shadow-strength: 0.15;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-system);
      background-color: var(--color-bg-dark);
      color: var(--color-text-primary);
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: var(--spacing-xl);
      line-height: var(--line-height);
    }

    @supports (height: 100dvh) {
      body {
        height: 100dvh;
      }
    }

    .container {
      max-width: 800px;
      width: 100%;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    #startScreen,
    #quizScreen,
    #resultsScreen {
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      padding: var(--spacing-xl);
    }

    @supports (height: 100dvh) {

      .container,
      #startScreen,
      #quizScreen,
      #resultsScreen {
        height: 100dvh;
      }
    }

    #startScreen {
      justify-content: space-between;
    }

    .start-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--spacing-2xl);
      flex: 1;
      justify-content: center;
    }

    #quizScreen {
      justify-content: flex-start;
      gap: var(--spacing-lg);
    }

    #resultsScreen {
      justify-content: center;
      gap: var(--spacing-2xl);
    }

    #startScreen.hidden,
    #quizScreen.hidden,
    #resultsScreen.hidden {
      display: none;
    }

    header {
      text-align: center;
    }

    .progress {
      align-self: flex-start;
      width: 100%;
    }

    .options {
      align-self: stretch;
      width: 100%;
      margin-top: auto;
    }

    #nextButton {
      align-self: center;
      visibility: hidden;
    }

    #nextButton:not(.hidden) {
      visibility: visible;
    }

    #nextButton.hidden {
      visibility: hidden;
      display: block;
    }

    h1 {
      font-size: 4rem;
      color: var(--color-primary);
      font-family: var(--font-mono);
      font-weight: bold;
    }

    .subtitle {
      color: var(--color-text-secondary);
      font-size: var(--font-size-xl);
      font-style: italic;
    }

    .subsubtitle {
      color: var(--color-text-secondary);
      font-family: var(--font-mono);
      width: 75%;
      margin: 0 auto;
      font-size: var(--font-size-lg);
      font-style: italic;
      background-color: var(--color-bg-light);
      padding: var(--spacing-lg);
      border-radius: var(--radius-lg);
      text-wrap: balance;
    }

    .progress {
      text-align: center;
      align-content: center;
      color: var(--color-text-secondary);
      font-size: var(--font-size-base);
      height: var(--spacing-4xl);
    }


    .email-container {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      background-color: var(--color-code-bg);
      border: var(--border-medium) solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-xl);
      font-family: var(--font-mono);
      font-size: 1.25rem;
      color: var(--color-text-primary);
      overflow-x: auto;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, calc(var(--shadow-strength) * 0.6));
      max-width: 600px;
      text-align: center;
      text-wrap: nowrap;
      min-height: 4rem;
    }

    .email-text {
      color: var(--wong-orange);
      font-weight: bold;
    }

    .options {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-lg);
      max-width: 600px;
      margin: 0 auto;
    }

    .option {
      background-color: var(--color-bg-light);
      border: var(--border-medium) solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg) var(--spacing-xl);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: var(--spacing-lg);
      font-size: var(--font-size-base);
    }

    .option:hover:not(.disabled) {
      background-color: var(--color-bg-lighter);
      border-color: var(--color-border-hover);
    }

    .option.selected {
      border-color: var(--color-primary);
      background-color: rgba(230, 159, 0, 0.15);
    }

    .option.correct {
      border-color: var(--color-accent-green);
      background-color: var(--color-correct-bg);
    }

    .option.incorrect {
      border-color: var(--color-error);
      background-color: var(--color-incorrect-bg);
    }

    .option.disabled:not(.correct):not(.incorrect) {
      opacity: 0.6;
    }

    .option-key {
      background-color: var(--color-border-light);
      color: var(--color-text-primary);
      width: 32px;
      height: 32px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      flex-shrink: 0;
      font-size: var(--font-size-base);
      pointer-events: none;
    }

    .option-text {
      font-family: var(--font-mono);
      flex: 1;
      font-weight: bold;
      pointer-events: none;
    }

    .explanation {
      display: flex;
      align-items: center;
      justify-content: center;
      max-width: 600px;
      text-align: center;
      padding: var(--spacing-lg);
      background-color: var(--color-bg-light);
      border-radius: var(--radius-md);
      border-left: var(--border-thick) solid var(--color-accent-green);
      visibility: hidden;
      font-size: var(--font-size-lg);
      text-wrap: balance;
      width: 100%;
      min-height: 6rem;
      font-variant-numeric: lining-nums;
    }

    .explanation.correct {
      border-left-color: var(--color-accent-green);
      background-color: var(--color-correct-bg);
    }

    .explanation.incorrect {
      border-left-color: var(--color-error);
      background-color: var(--color-incorrect-bg);
    }


    .button {
      background-color: var(--color-primary);
      color: var(--color-bg-dark);
      border: none;
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg) var(--spacing-3xl);
      font-size: var(--font-size-lg);
      font-weight: bold;
      cursor: pointer;
      max-width: 250px;
      width: 100%;
    }

    .button:hover {
      background-color: var(--color-primary-hover);
    }


    .start-screen,
    .results-screen {
      text-align: center;
    }

    .results-screen h2 {
      font-size: 3rem;
      margin-bottom: var(--spacing-4xl);
      color: var(--color-primary);
    }

    .score {
      font-size: 5rem;
      margin: var(--spacing-4xl) 0;
      color: var(--color-primary);
      font-weight: bold;
    }

    .share-box {
      position: relative;
      background-color: var(--color-bg-light);
      border: var(--border-medium) solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg);
      padding-right: calc(var(--spacing-lg) + 32px);
      margin-top: var(--spacing-xl);
      max-width: 500px;
      width: 100%;
      font-family: var(--font-mono);
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
    }

    .copy-button {
      position: absolute;
      top: var(--spacing-sm);
      right: var(--spacing-sm);
      background-color: var(--color-bg-lighter);
      border: var(--border-thin) solid var(--color-border);
      border-radius: var(--radius-sm);
      padding: var(--spacing-xs);
      cursor: pointer;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
    }

    .copy-button:hover {
      background-color: var(--color-border);
    }

    .copy-icon {
      width: 14px;
      height: 14px;
      stroke: var(--color-text-secondary);
    }

    .button-row {
      display: flex;
      gap: var(--spacing-md);
      margin-top: var(--spacing-lg);
      justify-content: center;
      flex-wrap: wrap;
    }

    .icon-button {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-md) var(--spacing-lg);
      font-size: var(--font-size-base);
      min-width: 100px;
      justify-content: center;
    }

    .button-icon {
      width: 16px;
      height: 16px;
      stroke: currentColor;
    }

    .share-button {
      background-color: var(--color-secondary);
    }

    .share-button:hover {
      background-color: var(--color-secondary-hover);
    }

    .copy-button-main {
      background-color: var(--color-bg-lighter);
      color: var(--color-text-primary);
      border: var(--border-medium) solid var(--color-border);
    }

    .copy-button-main:hover {
      background-color: var(--color-border);
    }

    .footer {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
      margin-top: auto;
      padding-bottom: var(--spacing-md);
    }

    .footer a {
      color: var(--color-primary);
      text-decoration: none;
      transition: color var(--transition-fast);
    }

    .footer a:hover {
      color: var(--color-primary-hover);
    }

    .hidden {
      display: none;
    }

    @media (max-width: 600px) {
      body {
        padding: var(--spacing-sm);
      }

      #startScreen,
      #quizScreen,
      #resultsScreen {
        padding: var(--spacing-md);
      }

      h1 {
        font-size: 2.5rem;
      }

      .subtitle {
        font-size: var(--font-size-lg);
      }

      .subsubtitle {
        font-size: var(--font-size-base);
      }

      .email-container {
        font-size: var(--font-size-base);
        padding: var(--spacing-lg);
      }

      .options {
        gap: var(--spacing-md);
      }

      .option {
        padding: var(--spacing-md) var(--spacing-lg);
        font-size: var(--font-size-sm);
      }

      .option-key {
        width: 28px;
        height: 28px;
        font-size: var(--font-size-sm);
      }

      .button {
        font-size: var(--font-size-base);
        max-width: 200px;
      }

      .progress {
        font-size: var(--font-size-sm);
      }

      .score {
        font-size: 3rem;
      }

      .results-screen h2 {
        font-size: 2rem;
      }
    }

    .toast {
      position: fixed;
      bottom: var(--spacing-xl);
      left: 50%;
      transform: translateX(-50%);
      background-color: var(--color-primary);
      color: var(--color-bg-dark);
      padding: var(--spacing-md) calc(var(--spacing-xl) + var(--spacing-xs));
      border-radius: var(--radius-md);
      font-weight: bold;
      opacity: 0;
    }

    .toast.show {
      opacity: 1;
    }

    .theme-toggle {
      position: fixed;
      top: var(--spacing-xl);
      right: var(--spacing-xl);
      background-color: var(--color-bg-light);
      border: var(--border-medium) solid var(--color-border);
      border-radius: var(--radius-md);
      padding: var(--spacing-sm) var(--spacing-md);
      cursor: pointer;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      font-size: var(--font-size-base);
      color: var(--color-text-primary);
    }

    .theme-toggle:hover {
      background-color: var(--color-bg-lighter);
      border-color: var(--color-border-hover);
      transform: translateY(-1px);
    }

    .theme-toggle:active {
      transform: translateY(0);
    }

    .theme-icon {
      width: 20px;
      height: 20px;
      display: block;
    }

    [data-theme="light"] .moon-icon {
      display: none;
    }

    [data-theme="dark"] .sun-icon,
    :root:not([data-theme]) .sun-icon {
      display: none;
    }

    @media (max-width: 600px) {
      .theme-toggle {
        top: var(--spacing-md);
        right: var(--spacing-md);
        padding: var(--spacing-xs) var(--spacing-sm);
      }
    }
  </style>
</head>

<body>
  <!-- Theme toggle button -->
  <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
    <svg class="theme-icon sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
    <svg class="theme-icon moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
    </svg>
  </button>

  <div class="container">
    <div id="startScreen" class="start-screen">
      <div class="start-content">
        <header>
          <h1 id="main-title">isValidEmail("wtf")</h1>
          <p class="subtitle">How well do you know email validation?</p>
        </header>

        <p class="subsubtitle">
          Test your knowledge of what makes an email address valid or invalid.
          Prepare to be surprised by the RFC 5322 specification!
        </p>
        <button class="button" onclick="startQuiz()">Start Quiz</button>
      </div>

      <div class="footer">
        <p>
          made with ❤️ by <a href="https://samwho.dev" target="_blank" rel="noopener">samwho</a>
        </p>
      </div>
    </div>

    <div id="quizScreen" class="hidden">
      <div class="progress">
        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">15</span>
      </div>

      <div class="email-container">
        <div class="email-text" id="emailDisplay"></div>
      </div>
      <div class="explanation" id="explanation"></div>

      <div class="options" id="options"></div>

      <button id="nextButton" class="button hidden" onclick="nextQuestion()">Next Question</button>
    </div>

    <div id="resultsScreen" class="results-screen hidden">
      <h2>Results are in!</h2>
      <div class="score">
        <span id="correctCount">0</span> / <span id="totalCount">0</span>
      </div>
      <p id="resultMessage"></p>

      <div class="share-box">
        <button class="copy-button" onclick="copyShareMessage()" title="Copy to clipboard">
          <svg class="copy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
          </svg>
        </button>
        <div id="shareMessage"></div>
      </div>

      <div class="button-row">
        <button class="button icon-button share-button" onclick="shareResults()">
          <svg class="button-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
            <polyline points="16,6 12,2 8,6"></polyline>
            <line x1="12" y1="2" x2="12" y2="15"></line>
          </svg>
          Share
        </button>
        <button class="button icon-button copy-button-main" onclick="copyShareMessage()">
          <svg class="button-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2v1"></path>
          </svg>
          Copy
        </button>
      </div>
      <div class="footer">
        <p>
          made with ❤️ by <a href="https://samwho.dev" target="_blank" rel="noopener">samwho</a>
        </p>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    function getTheme() {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme) {
        return savedTheme;
      }

      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
        return 'light';
      }

      return 'dark';
    }

    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
    }

    function toggleTheme() {
      const currentTheme = getTheme();
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      setTheme(newTheme);
    }

    document.addEventListener('DOMContentLoaded', () => {
      setTheme(getTheme());

      if (window.matchMedia) {
        const mediaQuery = window.matchMedia('(prefers-color-scheme: light)');
        mediaQuery.addEventListener('change', (e) => {
          if (!localStorage.getItem('theme')) {
            setTheme(e.matches ? 'light' : 'dark');
          }
        });
      }

      document.getElementById('startScreen').classList.remove('hidden');
    });

    setTheme(getTheme());

    const rawQuestions = [
      {
        email: 'user@example.com',
        options: ['Valid', 'Invalid'],
        correct: 0,
        explanation: 'This is a classic valid email address format.'
      },
      {
        email: 'test.email+tag@domain.co.uk',
        options: ['Valid', 'Invalid'],
        correct: 0,
        explanation: 'Dots in the local part and plus signs for tagging are allowed.'
      },
      {
        email: 'user@',
        options: ['Valid', 'Invalid'],
        correct: 1,
        explanation: 'Missing domain part makes this invalid.'
      },
      {
        email: '@example.com',
        options: ['Valid', 'Invalid'],
        correct: 1,
        explanation: 'Missing local part (before @) makes this invalid.'
      },
      {
        email: 'user@example',
        options: ['Valid', 'Invalid'],
        correct: 0,
        explanation: 'Surprisingly, this is valid! Top-level domains are not required by RFC 5322.'
      },
      {
        email: '"test@test"@example.com',
        options: ['Valid', 'Invalid'],
        correct: 0,
        explanation: 'Quoted strings in the local part can contain @ symbols and other special characters.'
      },
      {
        email: 'user..name@example.com',
        options: ['Valid', 'Invalid'],
        correct: 1,
        explanation: 'Consecutive dots are not allowed in the local part.'
      },
      {
        email: '.user@example.com',
        options: ['Valid', 'Invalid'],
        correct: 1,
        explanation: 'The local part cannot start with a dot.'
      },
      {
        email: 'user.@example.com',
        options: ['Valid', 'Invalid'],
        correct: 1,
        explanation: 'The local part cannot end with a dot.'
      },
      {
        email: 'user@ex ample.com',
        options: ['Valid', 'Invalid'],
        correct: 1,
        explanation: 'Spaces are not allowed in the domain part.'
      },
      {
        email: 'very.long.email.address.that.keeps.going.and.going@example.com',
        options: ['Valid', 'Invalid'],
        correct: 0,
        explanation: 'Long email addresses are valid as long as they don\'t exceed 320 characters total.'
      },
      {
        email: 'user@example.com.',
        options: ['Valid', 'Invalid'],
        correct: 0,
        explanation: 'A trailing dot in the domain is valid (it represents the DNS root).'
      },
      {
        email: 'user@[192.168.1.1]',
        options: ['Valid', 'Invalid'],
        correct: 0,
        explanation: 'IP addresses in square brackets are valid domain formats.'
      },
      {
        email: 'user+tag+another@example.com',
        options: ['Valid', 'Invalid'],
        correct: 0,
        explanation: 'Multiple plus signs and tags are perfectly valid.'
      },
      {
        email: '"spaces in quotes"@example.com',
        options: ['Valid', 'Invalid'],
        correct: 0,
        explanation: 'Quoted strings can contain spaces and many special characters.'
      }
    ];

    function shuffleArray(array) {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    const questions = rawQuestions.map(question => {
      const optionsWithIndices = question.options.map((option, index) => ({
        text: option,
        originalIndex: index
      }));

      const shuffledOptions = shuffleArray(optionsWithIndices);

      const newCorrectIndex = shuffledOptions.findIndex(
        option => option.originalIndex === question.correct
      );

      return {
        ...question,
        options: shuffledOptions.map(option => option.text),
        correct: newCorrectIndex
      };
    });

    let currentQuestionIndex = 0;
    let score = 0;
    let answered = false;
    let chosenAnswer = null;

    function startQuiz() {
      document.getElementById('startScreen').classList.add('hidden');
      document.getElementById('quizScreen').classList.remove('hidden');
      document.getElementById('totalQuestions').textContent = questions.length;
      showQuestion();
    }

    function showQuestion() {
      const question = questions[currentQuestionIndex];
      document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
      document.getElementById('emailDisplay').textContent = question.email;

      const optionsContainer = document.getElementById('options');
      optionsContainer.innerHTML = '';

      question.options.forEach((option, index) => {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'option';
        optionDiv.onclick = () => selectOption(index);

        const keyDiv = document.createElement('div');
        keyDiv.className = 'option-key';
        keyDiv.textContent = (index + 1).toString();

        const textDiv = document.createElement('div');
        textDiv.className = 'option-text';
        textDiv.textContent = option;

        optionDiv.appendChild(keyDiv);
        optionDiv.appendChild(textDiv);
        optionsContainer.appendChild(optionDiv);
      });

      const explanation = document.getElementById('explanation');
      explanation.classList.remove('correct', 'incorrect');
      explanation.style.visibility = 'hidden';
      document.getElementById('nextButton').classList.add('hidden');

      answered = false;
      chosenAnswer = null;
    }

    function selectOption(index) {
      if (answered) return;

      answered = true;
      chosenAnswer = index;
      const question = questions[currentQuestionIndex];
      const options = document.querySelectorAll('.option');

      options[index].classList.add('selected');

      const isCorrect = index === question.correct;

      if (isCorrect) {
        options[index].classList.add('correct');
        score++;
      } else {
        options[index].classList.add('incorrect');
        options[question.correct].classList.add('correct');
      }

      options.forEach(option => option.classList.add('disabled'));

      const explanation = document.getElementById('explanation');
      explanation.innerHTML = `<p>${question.explanation}</p>`;
      explanation.style.visibility = 'visible';
      explanation.classList.add(isCorrect ? 'correct' : 'incorrect');

      document.getElementById('nextButton').classList.remove('hidden');
    }

    function nextQuestion() {
      currentQuestionIndex++;
      if (currentQuestionIndex < questions.length) {
        showQuestion();
      } else {
        showResults();
      }
    }

    function showResults() {
      document.getElementById('quizScreen').classList.add('hidden');
      document.getElementById('resultsScreen').classList.remove('hidden');
      document.getElementById('correctCount').textContent = score;
      document.getElementById('totalCount').textContent = questions.length;

      const percentage = Math.round((score / questions.length) * 100);
      let message = '';

      if (percentage === 100) {
        message = 'Perfect! You clearly know your email validation specs.';
      } else if (percentage >= 80) {
        message = 'Excellent! You have a solid understanding of email validation.';
      } else if (percentage >= 60) {
        message = 'Good job! Email validation is trickier than most people think.';
      } else if (percentage >= 40) {
        message = 'Not bad, but email validation has some surprising edge cases!';
      } else {
        message = 'Email validation is full of surprises. The RFC 5322 spec might shock you!';
      }

      document.getElementById('resultMessage').textContent = message;

      const shareText = `I scored ${score}/${questions.length} on the email validation quiz at https://e-mail.wtf - how well do you know email validation?`;
      document.getElementById('shareMessage').textContent = shareText;

      window.history.replaceState({}, '', window.location.pathname);
    }

    function copyShareMessage() {
      const shareMessage = document.getElementById('shareMessage').textContent;
      navigator.clipboard.writeText(shareMessage);
      showToast('Results copied to clipboard!');
    }

    function shareResults() {
      const shareMessage = document.getElementById('shareMessage').textContent;

      if (navigator.share) {
        navigator.share({
          text: shareMessage
        });
      } else {
        navigator.clipboard.writeText(shareMessage);
        showToast('Results copied to clipboard!');
      }
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    function restartQuiz() {
      currentQuestionIndex = 0;
      score = 0;
      chosenAnswer = null;
      document.getElementById('resultsScreen').classList.add('hidden');
      document.getElementById('startScreen').classList.remove('hidden');
      window.history.replaceState({}, '', window.location.pathname);
    }

    document.addEventListener('keydown', (e) => {
      if (document.getElementById('quizScreen').classList.contains('hidden')) return;

      if (e.key >= '1' && e.key <= '2' && !answered) {
        selectOption(parseInt(e.key) - 1);
      } else if ((e.key === 'Enter' || e.key === ' ') && answered) {
        e.preventDefault();
        nextQuestion();
      }
    });
  </script>
</body>

</html>
